<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generic CRUD Front-end</title>
</head>
<body>
    <ul id="item-list"></ul>
    Item: <input id="item-textbox" type="text"/> 
    <button onclick="createItem()">Create</button> <br>


    ID: <select id="id-list" onchange="selectItem()"></select>
    <button onclick="updateItem()">Update</button>
    <button onclick="deleteItem()">Delete</button> <br>
    <script>

        let itemList = document.getElementById("item-list");
        let itemTextbox = document.getElementById("item-textbox");
        let idList = document.getElementById("id-list");

        readItems();

        // READ
        function readItems( ){
            fetch( "http://localhost/generic-php-json-crud-backend/backend.php", {
                method: "GET"
            } )
            .then( ( response ) => {
                return response.json( );
            } ).then( ( data ) => {
                itemList.innerHTML = "";
                idList.innerHTML = "";

                for( let item of data ){
                    itemList.innerHTML += `<li>${item.text}</li>`;
                    idList.innerHTML += `<option value="${item.id}">${item.id}</option>`;
                }
            } );
        }

        // CREATE
        function createItem( ){
            fetch( "http://localhost/generic-php-json-crud-backend/backend.php", {
                method: "POST",
                body: JSON.stringify( { text: itemTextbox.value } )
            } ).then( () => {
                readItems()
            } );
        }

        // UPDATE
        function updateItem( ){
            fetch( "http://localhost/generic-php-json-crud-backend/backend.php", {
                method: "PUT",
                body: JSON.stringify( { id: Number( idList.value ), text: itemTextbox.value } )
            } ).then( () => {
                readItems()
            } );
        }
        
        // DELETE
        function deleteItem( ){
            fetch( "http://localhost/generic-php-json-crud-backend/backend.php", {
                method: "DELETE",
                body: JSON.stringify( { id: idList.value } )
            } ).then( () => {
                readItems()
            } );
        }

        function selectItem( ){
            itemTextbox.value = itemList.children[ idList.value ].innerHTML;
        }
    </script>
</body>
</html>